<!-- Event Pxml -->
<view class="container">
  <!-- Fixed Tab Bar -->
  <fixed-tab-bar 
    tabs="{{tabs}}"
    activeTab="{{activeTab}}"
    bindtabchange="onTabChange"
    className="event-tab-bar"
  ></fixed-tab-bar>
  
  <!-- ç›´æ¥æµ‹è¯•èµ›äº‹æ˜¾ç¤ºï¼ˆç»•è¿‡tabç»„ä»¶ï¼‰ -->
  <view style="background: lime; padding: 20px; margin: 10px;">
    <text style="font-size: 16px; font-weight: bold;">ç›´æ¥æµ‹è¯• - èµ›äº‹æ•°é‡: {{events.length}}</text>
    <view wx:if="{{events.length > 0}}" style="margin-top: 10px;">
      <view wx:for="{{events}}" wx:key="_id" style="background: white; padding: 10px; margin: 5px; border: 1px solid #ccc;">
        <text>{{item.name}} - {{item.eventType}} - {{item.status}}</text>
      </view>
    </view>
    <view wx:else style="color: red;">
      æ²¡æœ‰èµ›äº‹æ•°æ®
    </view>
  </view>

  <!-- Tab Content Container -->
  <view
    class="tab-content-container"
    bindtouchstart="onTouchStart"
    bindtouchmove="onTouchMove"
    bindtouchend="onTouchEnd"
  >

    <!-- å…¨å±€è°ƒè¯•ä¿¡æ¯ -->
    <view style="background: yellow; padding: 10px; margin: 5px; font-size: 14px; border: 2px solid blue;">
      å…¨å±€çŠ¶æ€: activeTab={{activeTab}}, loading={{loading}}, error={{error}}
    </view>

    <!-- Tab Content Component -->
    <tab-content 
      activeTab="{{activeTab}}"
      loading="{{loading}}"
      error="{{error}}"
      enableLazyLoad="{{true}}"
      enableCache="{{true}}"
      bindtabcontentchange="onTabContentChange"
      bindlazyload="onTabLazyLoad"
      bindretry="onTabRetry"
    >
      <!-- All Events Tab Content -->
      <view slot="all-events">
        <!-- Search Bar -->
        <view class="search-bar {{showSearch ? 'show' : ''}}">
          <input 
            class="search-input" 
            placeholder="æœç´¢èµ›äº‹åç§°ã€æè¿°ã€åœºåœ°..." 
            value="{{searchQuery}}"
            bindinput="onSearchInput"
            bindconfirm="searchEvents"
          />
          <button class="search-submit" bindtap="searchEvents">æœç´¢</button>
        </view>

        <!-- Statistics Panel -->
        <view class="stats-panel" wx:if="{{isLoggedIn && eventStats}}">
          <view class="stats-item">
            <text class="stats-number">{{eventStats.total}}</text>
            <text class="stats-label">æ€»èµ›äº‹</text>
          </view>
          <view class="stats-item">
            <text class="stats-number">{{eventStats.totalParticipants}}</text>
            <text class="stats-label">æ€»å‚ä¸è€…</text>
          </view>
          <view class="stats-item">
            <text class="stats-number">Â¥{{eventStats.totalRevenue}}</text>
            <text class="stats-label">æ€»æ”¶å…¥</text>
          </view>
        </view>

        <!-- User Events Toggle -->
        <view class="user-events-toggle" wx:if="{{isLoggedIn}}">
          <button class="toggle-btn {{showUserEvents ? 'active' : ''}}" bindtap="toggleUserEvents">
            æˆ‘çš„èµ›äº‹
          </button>
          
          <view class="user-event-types" wx:if="{{showUserEvents}}">
            <view 
              class="type-btn {{userEventType === 'all' ? 'active' : ''}}"
              bindtap="switchUserEventType"
              data-type="all"
            >
              å…¨éƒ¨
            </view>
            <view 
              class="type-btn {{userEventType === 'organized' ? 'active' : ''}}"
              bindtap="switchUserEventType"
              data-type="organized"
            >
              æˆ‘ç»„ç»‡çš„
            </view>
            <view 
              class="type-btn {{userEventType === 'participated' ? 'active' : ''}}"
              bindtap="switchUserEventType"
              data-type="participated"
            >
              æˆ‘å‚ä¸çš„
            </view>
          </view>
        </view>

        <!-- Filter Panel (Hidden by default) -->
        <view class="filter-panel {{showFilter ? 'show' : ''}}">
          <view class="filter-section">
      <view class="filter-section-title">èµ›äº‹ç±»å‹</view>
      <view class="filter-options">
        <view 
          wx:for="{{eventTypes}}" 
          wx:key="id" 
          class="filter-option {{filters.eventType === item.id ? 'active' : ''}}"
          bindtap="applyFilter"
          data-field="eventType"
          data-value="{{item.id}}"
        >
          {{item.name}}
        </view>
      </view>
    </view>

    <view class="filter-section">
      <view class="filter-section-title">èµ›äº‹çŠ¶æ€</view>
      <view class="filter-options">
        <view 
          wx:for="{{statusOptions}}" 
          wx:key="id" 
          class="filter-option {{filters.status === item.id ? 'active' : ''}}"
          bindtap="applyFilter"
          data-field="status"
          data-value="{{item.id}}"
        >
          {{item.name}}
        </view>
      </view>
    </view>
    
    <view class="filter-section">
      <view class="filter-section-title">åœ°åŒº</view>
      <input 
        class="filter-input" 
        placeholder="æŒ‰åœ°åŒºæœç´¢" 
        value="{{filters.region}}"
        bindinput="inputRegion"
      />
    </view>
    
    <view class="filter-section">
      <view class="filter-section-title">æ—¥æœŸèŒƒå›´</view>
      <view class="date-range">
        <picker mode="date" bindchange="startDateChange">
          <view class="date-picker {{filters.dateRange && filters.dateRange.start ? '' : 'placeholder'}}">
            {{filters.dateRange && filters.dateRange.start || 'å¼€å§‹æ—¥æœŸ'}}
          </view>
        </picker>
        <view class="date-separator">è‡³</view>
        <picker mode="date" bindchange="endDateChange">
          <view class="date-picker {{filters.dateRange && filters.dateRange.end ? '' : 'placeholder'}}">
            {{filters.dateRange && filters.dateRange.end || 'ç»“æŸæ—¥æœŸ'}}
          </view>
        </picker>
      </view>
    </view>

    <view class="filter-section">
      <view class="filter-section-title">æ’åºæ–¹å¼</view>
      <view class="sort-options">
        <view 
          class="sort-option {{sortBy === 'eventDate' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="eventDate"
        >
          æŒ‰æ—¥æœŸ {{sortBy === 'eventDate' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}
        </view>
        <view 
          class="sort-option {{sortBy === 'createdAt' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="createdAt"
        >
          æŒ‰åˆ›å»ºæ—¶é—´ {{sortBy === 'createdAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}
        </view>
        <view 
          class="sort-option {{sortBy === 'currentParticipants' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="currentParticipants"
        >
          æŒ‰å‚ä¸äººæ•° {{sortBy === 'currentParticipants' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}
        </view>
      </view>
    </view>
    
          <view class="filter-actions">
            <button class="btn-reset" bindtap="resetFilter">é‡ç½®</button>
            <button class="btn-apply" bindtap="toggleFilter">åº”ç”¨</button>
          </view>
        </view>

        <!-- Batch Actions Bar -->
  <view class="batch-actions-bar {{showBatchActions ? 'show' : ''}}">
    <view class="batch-info">
      å·²é€‰æ‹© {{selectedEvents.length}} ä¸ªèµ›äº‹
    </view>
    <view class="batch-buttons">
      <button class="batch-btn" bindtap="batchUpdateStatus" data-status="upcoming">
        æ‰¹é‡å¼€å§‹
      </button>
      <button class="batch-btn" bindtap="batchUpdateStatus" data-status="cancelled">
        æ‰¹é‡å–æ¶ˆ
      </button>
      <button class="batch-btn clear" bindtap="clearSelection">
        æ¸…é™¤é€‰æ‹©
      </button>
    </view>
  </view>
  
  <!-- Events List -->
  <view class="events-list {{viewMode}}">
    <!-- List Header with Batch Selection -->
    <view class="list-header" wx:if="{{events.length > 0 && isLoggedIn}}">
      <view class="batch-select">
        <checkbox bindchange="selectAllEvents">å…¨é€‰</checkbox>
      </view>
      <view class="list-count">
        å…± {{events.length}} ä¸ªèµ›äº‹
      </view>
    </view>

    <!-- User Events Display -->
    <block wx:if="{{showUserEvents && userEvents.length > 0}}">
      <view class="section-title">æˆ‘çš„èµ›äº‹</view>
      <view
        wx:for="{{userEvents}}"
        wx:key="_id"
        class="event-card user-event {{item.userRole}}"
        bindtap="goToEventDetail"
        data-id="{{item._id}}"
      >
        <!-- Selection Checkbox -->
        <view class="event-select" wx:if="{{isLoggedIn}}" catchtap="toggleEventSelection" data-id="{{item._id}}">
          <checkbox checked="{{selectedEvents.indexOf(item._id) > -1}}"></checkbox>
        </view>

        <!-- Event Card Cover -->
        <view class="event-cover">
          <text class="cover-icon">ğŸ¾</text>
          <view class="role-badge {{item.userRole}}">
            {{item.userRole === 'organizer' ? 'ç»„ç»‡è€…' : 'å‚ä¸è€…'}}
          </view>
        </view>
        
        <!-- Event Card Content -->
        <view class="event-content">
          <view class="event-header">
            <view class="event-title">{{item.name}}</view>
            <view class="event-actions">
              <button class="action-btn share" catchtap="shareEvent" data-id="{{item._id}}">
                åˆ†äº«
              </button>
            </view>
          </view>
          
          <view class="event-info">
            <view class="event-type">{{item.eventType}}</view>
            <view class="event-status status-{{item.status}}">
              {{item.status === 'registration' ? 'æŠ¥åä¸­' : 
                item.status === 'upcoming' ? 'å³å°†å¼€å§‹' :
                item.status === 'ongoing' ? 'è¿›è¡Œä¸­' :
                item.status === 'completed' ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
            </view>
          </view>
          
          <view class="event-details">
            <view class="event-detail">
              <text class="detail-icon">ğŸ“…</text>
              <text>{{item.eventDate || 'TBD'}}</text>
            </view>
            <view class="event-detail">
              <text class="detail-icon">ğŸ“</text>
              <text>{{item.venue || 'TBD'}} â€¢ {{item.region || 'TBD'}}</text>
            </view>
            <view class="event-detail">
              <text class="detail-icon">ğŸ‘¥</text>
              <text>{{item.currentParticipants || 0}}/{{item.maxParticipants || 'âˆ'}} äºº</text>
            </view>
            <view class="event-detail" wx:if="{{item.registrationFee > 0}}">
              <text class="detail-icon">ğŸ’°</text>
              <text>Â¥{{item.registrationFee}}</text>
            </view>
          </view>
          
          <view class="event-footer">
            <view class="deadline" wx:if="{{item.registrationDeadline}}">
              æŠ¥åæˆªæ­¢: {{item.registrationDeadline}}
            </view>
            <view class="event-actions">
              <button 
                wx:if="{{item.userRole === 'participant' && item.status === 'registration'}}"
                class="btn-cancel" 
                catchtap="cancelRegistration" 
                data-id="{{item._id}}"
              >
                å–æ¶ˆæŠ¥å
              </button>
              <button 
                wx:elif="{{!item.isRegistered && item.status === 'registration'}}"
                class="btn-register" 
                catchtap="registerEvent" 
                data-id="{{item._id}}"
              >
                æŠ¥å
              </button>
              <view wx:else class="registration-status">
                {{item.isRegistered ? 'å·²æŠ¥å' : 'ä¸å¯æŠ¥å'}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- All Events Display -->
    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <view style="background: #f0f0f0; padding: 10px; margin: 10px; font-size: 12px; border: 2px solid red;">
      è°ƒè¯•ä¿¡æ¯:<br/>
      - activeTab: {{activeTab}}<br/>
      - showUserEvents: {{showUserEvents}}<br/>
      - events.length: {{events.length}}<br/>
      - loading: {{loading}}<br/>
      - error: {{error}}<br/>
      - æ¸²æŸ“æ¡ä»¶: {{!showUserEvents && events.length > 0}}
    </view>

    <block wx:if="{{!showUserEvents && events.length > 0}}">
      <view class="section-title" wx:if="{{searchQuery}}">
        æœç´¢ç»“æœ "{{searchQuery}}"
      </view>
      <view
        wx:for="{{events}}"
        wx:key="_id"
        class="event-card {{viewMode}}-view"
        bindtap="goToEventDetail"
        data-id="{{item._id}}"
      >
        <!-- Selection Checkbox -->
        <view class="event-select" wx:if="{{isLoggedIn}}" catchtap="toggleEventSelection" data-id="{{item._id}}">
          <checkbox checked="{{selectedEvents.indexOf(item._id) > -1}}"></checkbox>
        </view>

        <!-- Event Card Cover -->
        <view class="event-cover">
          <text class="cover-icon">ğŸ¾</text>
          <view class="event-badge" wx:if="{{item.isRegistered}}">
            å·²æŠ¥å
          </view>
        </view>
        
        <!-- Event Card Content -->
        <view class="event-content">
          <view class="event-header">
            <view class="event-title">{{item.name}}</view>
            <view class="event-actions">
              <button class="action-btn share" catchtap="shareEvent" data-id="{{item._id}}">
                åˆ†äº«
              </button>
            </view>
          </view>
          
          <view class="event-info">
            <view class="event-type">{{item.eventType}}</view>
            <view class="event-status status-{{item.status}}">
              {{item.status === 'registration' ? 'æŠ¥åä¸­' : 
                item.status === 'upcoming' ? 'å³å°†å¼€å§‹' :
                item.status === 'ongoing' ? 'è¿›è¡Œä¸­' :
                item.status === 'completed' ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
            </view>
          </view>
          
          <view class="event-details">
            <view class="event-detail">
              <text class="detail-icon">ğŸ“…</text>
              <text>{{item.eventDate || 'TBD'}}</text>
            </view>
            <view class="event-detail">
              <text class="detail-icon">ğŸ“</text>
              <text>{{item.venue || 'TBD'}} â€¢ {{item.region || 'TBD'}}</text>
            </view>
            <view class="event-detail">
              <text class="detail-icon">ğŸ‘¤</text>
              <text>{{item.organizer.name || 'Tennis Heat'}}</text>
            </view>
            <view class="event-detail">
              <text class="detail-icon">ğŸ‘¥</text>
              <text>{{item.currentParticipants || 0}}/{{item.maxParticipants || 'âˆ'}} äºº</text>
            </view>
            <view class="event-detail" wx:if="{{item.registrationFee > 0}}">
              <text class="detail-icon">ğŸ’°</text>
              <text>Â¥{{item.registrationFee}}</text>
            </view>
          </view>
          
          <view class="event-footer">
            <view class="deadline" wx:if="{{item.registrationDeadline}}">
              æŠ¥åæˆªæ­¢: {{item.registrationDeadline}}
            </view>
            <view class="event-actions">
              <button 
                wx:if="{{item.isRegistered && item.status === 'registration'}}"
                class="btn-cancel" 
                catchtap="cancelRegistration" 
                data-id="{{item._id}}"
              >
                å–æ¶ˆæŠ¥å
              </button>
              <button 
                wx:elif="{{!item.isRegistered && item.status === 'registration'}}"
                class="btn-register" 
                catchtap="registerEvent" 
                data-id="{{item._id}}"
              >
                æŠ¥å
              </button>
              <button 
                wx:elif="{{item.status === 'registration' && item.registrationFee > 0}}"
                class="btn-pay" 
                catchtap="makePayment" 
                data-id="{{item._id}}"
              >
                æ”¯ä»˜æŠ¥åè´¹
              </button>
              <view wx:else class="registration-status">
                {{item.status === 'completed' ? 'å·²ç»“æŸ' : 
                  item.status === 'cancelled' ? 'å·²å–æ¶ˆ' : 'ä¸å¯æŠ¥å'}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- Empty State -->
    <view wx:if="{{!loading && events.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <view class="empty-text">æš‚æ— èµ›äº‹æ•°æ®ï¼Œç‚¹å‡»å³ä¸Šè§’â€œåˆ›å»ºâ€æŒ‰é’®å‘å¸ƒæ–°èµ›äº‹ï¼</view>
    </view>
    
    <!-- Loading State -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½èµ›äº‹ä¸­...</view>
    </view>
    
        <!-- Load More -->
        <view wx:if="{{hasMore && !loading && events.length > 0}}" class="load-more" bindtap="loadMoreEvents">
          åŠ è½½æ›´å¤š
        </view>
        </view>
      </view>
      
      <!-- Search Tab Content -->
      <view slot="search">
        <view class="search-content">
          <view class="search-header">
            <input 
              class="search-input-main" 
              placeholder="æœç´¢èµ›äº‹..." 
              value="{{tabData.search.query}}"
              bindinput="onSearchTabInput"
              bindconfirm="performSearch"
              focus="{{activeTab === 'search'}}"
            />
            <button class="search-btn-main" bindtap="performSearch">æœç´¢</button>
          </view>
          
          <!-- Search Results -->
          <view wx:if="{{tabData.search.results.length > 0}}" class="search-results">
            <view class="results-header">
              <text>æ‰¾åˆ° {{tabData.search.results.length}} ä¸ªç»“æœ</text>
            </view>
            <view
              wx:for="{{tabData.search.results}}"
              wx:key="_id"
              class="event-card search-result"
              bindtap="goToEventDetail"
              data-id="{{item._id}}"
            >
              <!-- Event card content similar to all-events -->
              <view class="event-cover">
                <text class="cover-icon">ğŸ¾</text>
              </view>
              <view class="event-content">
                <view class="event-title">{{item.name}}</view>
                <view class="event-info">
                  <view class="event-type">{{item.eventType}}</view>
                  <view class="event-status status-{{item.status}}">
                    {{item.status === 'registration' ? 'æŠ¥åä¸­' : 
                      item.status === 'upcoming' ? 'å³å°†å¼€å§‹' :
                      item.status === 'ongoing' ? 'è¿›è¡Œä¸­' :
                      item.status === 'completed' ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- Search History -->
          <view wx:elif="{{tabData.search.searchHistory.length > 0}}" class="search-history">
            <view class="history-header">
              <text>æœç´¢å†å²</text>
              <button class="clear-history" bindtap="clearSearchHistory">æ¸…é™¤</button>
            </view>
            <view class="history-items">
              <view 
                wx:for="{{tabData.search.searchHistory}}" 
                wx:key="*this"
                class="history-item"
                bindtap="searchFromHistory"
                data-query="{{item}}"
              >
                {{item}}
              </view>
            </view>
          </view>
          
          <!-- Empty Search State -->
          <view wx:else class="search-empty">
            <text class="empty-icon">ğŸ”</text>
            <view class="empty-text">è¾“å…¥å…³é”®è¯æœç´¢èµ›äº‹</view>
          </view>
        </view>
      </view>
      
      <!-- Create Tab Content -->
      <view slot="create">
        <view class="create-content">
          <view class="create-header">
            <text class="create-title">åˆ›å»ºæ–°èµ›äº‹</text>
          </view>
          
          <!-- Quick Create Form -->
          <view class="quick-create-form">
            <view class="form-section">
              <view class="form-label">èµ›äº‹åç§°</view>
              <input 
                class="form-input" 
                placeholder="è¯·è¾“å…¥èµ›äº‹åç§°"
                value="{{tabData.create.formData.name}}"
                bindinput="onCreateFormInput"
                data-field="name"
              />
            </view>
            
            <view class="form-section">
              <view class="form-label">èµ›äº‹ç±»å‹</view>
              <picker 
                bindchange="onEventTypeChange" 
                value="{{tabData.create.formData.eventTypeIndex}}" 
                range="{{eventTypes}}" 
                range-key="name"
              >
                <view class="picker-display">
                  {{eventTypes[tabData.create.formData.eventTypeIndex].name || 'è¯·é€‰æ‹©èµ›äº‹ç±»å‹'}}
                </view>
              </picker>
            </view>
            
            <view class="form-section">
              <view class="form-label">æ¯”èµ›åœºåœ°</view>
              <input 
                class="form-input" 
                placeholder="è¯·è¾“å…¥æ¯”èµ›åœºåœ°"
                value="{{tabData.create.formData.venue}}"
                bindinput="onCreateFormInput"
                data-field="venue"
              />
            </view>
            
            <view class="form-section">
              <view class="form-label">æ¯”èµ›æ—¶é—´</view>
              <picker 
                mode="multiSelector" 
                bindchange="onDateTimeChange"
                value="{{tabData.create.formData.dateTimeIndex}}"
                range="{{dateTimeRange}}"
              >
                <view class="picker-display">
                  {{tabData.create.formData.eventDate || 'è¯·é€‰æ‹©æ¯”èµ›æ—¶é—´'}}
                </view>
              </picker>
            </view>
            
            <view class="form-actions">
              <button class="btn-save-draft" bindtap="saveDraft">ä¿å­˜è‰ç¨¿</button>
              <button class="btn-create" bindtap="createEventQuick">ç«‹å³åˆ›å»º</button>
            </view>
          </view>
          
          <!-- Or Full Form Link -->
          <view class="full-form-link">
            <button class="btn-full-form" bindtap="goToFullCreateForm">
              ä½¿ç”¨å®Œæ•´è¡¨å•åˆ›å»º
            </button>
          </view>
        </view>
      </view>
      
      <!-- My Events Tab Content -->
      <view slot="my-events">
        <view class="my-events-content">
          <view class="my-events-header">
            <view class="event-type-tabs">
              <view 
                class="type-tab {{tabData.my.type === 'all' ? 'active' : ''}}"
                bindtap="switchMyEventType"
                data-type="all"
              >
                å…¨éƒ¨
              </view>
              <view 
                class="type-tab {{tabData.my.type === 'organized' ? 'active' : ''}}"
                bindtap="switchMyEventType"
                data-type="organized"
              >
                æˆ‘ç»„ç»‡çš„
              </view>
              <view 
                class="type-tab {{tabData.my.type === 'participated' ? 'active' : ''}}"
                bindtap="switchMyEventType"
                data-type="participated"
              >
                æˆ‘å‚ä¸çš„
              </view>
            </view>
          </view>
          
          <!-- My Events List -->
          <view wx:if="{{tabData.my.events.length > 0}}" class="my-events-list">
            <view
              wx:for="{{tabData.my.events}}"
              wx:key="_id"
              class="event-card my-event {{item.userRole}}"
              bindtap="goToEventDetail"
              data-id="{{item._id}}"
            >
              <view class="event-cover">
                <text class="cover-icon">ğŸ¾</text>
                <view class="role-badge {{item.userRole}}">
                  {{item.userRole === 'organizer' ? 'ç»„ç»‡è€…' : 'å‚ä¸è€…'}}
                </view>
              </view>
              <view class="event-content">
                <view class="event-title">{{item.name}}</view>
                <view class="event-info">
                  <view class="event-type">{{item.eventType}}</view>
                  <view class="event-status status-{{item.status}}">
                    {{item.status === 'registration' ? 'æŠ¥åä¸­' : 
                      item.status === 'upcoming' ? 'å³å°†å¼€å§‹' :
                      item.status === 'ongoing' ? 'è¿›è¡Œä¸­' :
                      item.status === 'completed' ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
                  </view>
                </view>
                <view class="quick-actions">
                  <button wx:if="{{item.userRole === 'organizer'}}" class="action-btn edit" catchtap="editEvent" data-id="{{item._id}}">
                    ç¼–è¾‘
                  </button>
                  <button class="action-btn share" catchtap="shareEvent" data-id="{{item._id}}">
                    åˆ†äº«
                  </button>
                </view>
              </view>
            </view>
          </view>
          
          <!-- Empty My Events State -->
          <view wx:else class="my-events-empty">
            <text class="empty-icon">ğŸ“‹</text>
            <view class="empty-text">
              {{tabData.my.type === 'organized' ? 'æ‚¨è¿˜æ²¡æœ‰ç»„ç»‡è¿‡èµ›äº‹' : 
                tabData.my.type === 'participated' ? 'æ‚¨è¿˜æ²¡æœ‰å‚ä¸è¿‡èµ›äº‹' : 'æ‚¨è¿˜æ²¡æœ‰ç›¸å…³èµ›äº‹'}}
            </view>
            <button wx:if="{{tabData.my.type === 'organized'}}" class="btn-create-first" bindtap="switchToCreateTab">
              åˆ›å»ºç¬¬ä¸€ä¸ªèµ›äº‹
            </button>
          </view>
        </view>
      </view>
      
      <!-- Popular Tab Content -->
      <view slot="popular">
        <view class="popular-content">
          <view class="popular-header">
            <view class="time-range-tabs">
              <view 
                class="time-tab {{tabData.popular.timeRange === '24h' ? 'active' : ''}}"
                bindtap="switchPopularTimeRange"
                data-range="24h"
              >
                24å°æ—¶
              </view>
              <view 
                class="time-tab {{tabData.popular.timeRange === '7d' ? 'active' : ''}}"
                bindtap="switchPopularTimeRange"
                data-range="7d"
              >
                7å¤©
              </view>
              <view 
                class="time-tab {{tabData.popular.timeRange === '30d' ? 'active' : ''}}"
                bindtap="switchPopularTimeRange"
                data-range="30d"
              >
                30å¤©
              </view>
            </view>
          </view>
          
          <!-- Popular Events List -->
          <view wx:if="{{tabData.popular.events.length > 0}}" class="popular-events-list">
            <view
              wx:for="{{tabData.popular.events}}"
              wx:key="_id"
              class="event-card popular-event"
              bindtap="goToEventDetail"
              data-id="{{item._id}}"
            >
              <view class="event-cover">
                <text class="cover-icon">ğŸ¾</text>
                <view class="popularity-badge">
                  <text class="fire-icon">ğŸ”¥</text>
                  <text class="popularity-score">{{item.popularityScore || 0}}</text>
                </view>
              </view>
              <view class="event-content">
                <view class="event-title">{{item.name}}</view>
                <view class="event-info">
                  <view class="event-type">{{item.eventType}}</view>
                  <view class="event-status status-{{item.status}}">
                    {{item.status === 'registration' ? 'æŠ¥åä¸­' : 
                      item.status === 'upcoming' ? 'å³å°†å¼€å§‹' :
                      item.status === 'ongoing' ? 'è¿›è¡Œä¸­' :
                      item.status === 'completed' ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
                  </view>
                </view>
                <view class="popularity-metrics">
                  <view class="metric">
                    <text class="metric-icon">ğŸ‘¥</text>
                    <text class="metric-value">{{item.currentParticipants || 0}}</text>
                  </view>
                  <view class="metric">
                    <text class="metric-icon">ğŸ‘€</text>
                    <text class="metric-value">{{item.viewCount || 0}}</text>
                  </view>
                  <view class="metric">
                    <text class="metric-icon">ğŸ’¬</text>
                    <text class="metric-value">{{item.commentCount || 0}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- Empty Popular State -->
          <view wx:else class="popular-empty">
            <text class="empty-icon">ğŸ”¥</text>
            <view class="empty-text">æš‚æ— çƒ­é—¨èµ›äº‹</view>
          </view>
        </view>
      </view>
      
    </tab-content>
    
  </view> <!-- End of tab-content-container -->
</view> 