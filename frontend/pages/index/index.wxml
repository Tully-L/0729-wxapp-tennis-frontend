<!-- index.wxml -->
<view class="container">
  <!-- Header -->
  <view class="header">
    <view class="header-content">
      <view class="title-section">
        <text class="app-title">ğŸ¾ ç½‘çƒçƒ­</text>
        <text class="app-subtitle">ä¸“ä¸šç½‘çƒèµ›äº‹å¹³å°</text>
      </view>
      <view class="header-actions">
        <view class="action-btn stats-btn" bindtap="viewMatchStats">
          <text class="action-icon">ğŸ“Š</text>
        </view>
        <view class="action-btn search-btn" bindtap="toggleSearch">
          <text class="action-icon">ğŸ”</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Search Bar -->
  <view class="search-container {{showSearch ? 'show' : ''}}">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-prefix-icon">ğŸ”</text>
        <input
          class="search-input"
          placeholder="æœç´¢æ¯”èµ›ã€é€‰æ‰‹æˆ–åœºåœ°"
          value="{{searchQuery}}"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
        />
        <view class="search-clear" bindtap="onClearSearch" wx:if="{{searchQuery}}">
          <text class="clear-icon">âœ•</text>
        </view>
      </view>
      <view class="search-action" bindtap="onSearch">
        <text class="search-action-text">æœç´¢</text>
      </view>
    </view>
  </view>
  
  <!-- Search Results -->
  <view class="search-results" wx:if="{{showSearch && searchQuery}}">
    <view wx:if="{{searchLoading}}" class="search-loading">
      <view class="loading-spinner"></view>
      <text>æœç´¢ä¸­...</text>
    </view>
    <view wx:elif="{{searchResults.length > 0}}" class="search-list">
      <view 
        wx:for="{{searchResults}}" 
        wx:key="_id" 
        class="search-item"
        bindtap="goToDetail"
        data-id="{{item._id}}"
      >
        <view class="search-item-title">{{item.matchName || item.eventType}}</view>
        <view class="search-item-info">
          <text class="search-item-venue">{{item.venue}}</text>
          <text class="search-item-time">{{formatMatchTime(item.scheduledTime)}}</text>
        </view>
      </view>
    </view>
    <view wx:elif="{{searchQuery.length >= 2}}" class="search-empty">
      <text>æœªæ‰¾åˆ°ç›¸å…³æ¯”èµ›</text>
    </view>
  </view>

  <!-- Top Tab Navigation -->
  <view class="tab-nav">
    <view 
      wx:for="{{tabs}}" 
      wx:key="index" 
      class="tab-item {{activeTab === index ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="{{index}}"
    >
      {{item}}
    </view>
  </view>
  
  <!-- Enhanced Filter Bar -->
  <view class="filter-bar">
    <view class="filter-title">æ¯”èµ›ç­›é€‰</view>
    <view class="filter-btn" bindtap="toggleFilter">
      <text>ç­›é€‰</text>
      <text class="filter-icon">ğŸ”</text>
    </view>
  </view>
  
  <!-- Filter Panel (Hidden by default) -->
  <view class="filter-panel {{showFilter ? 'show' : ''}}">
    <view class="filter-section">
      <view class="filter-section-title">èµ›äº‹ç±»å‹</view>
      <view class="filter-options">
        <view 
          wx:for="{{eventTypes}}" 
          wx:key="id" 
          class="filter-option {{filters.eventType === item.id ? 'active' : ''}}"
          bindtap="applyFilter"
          data-field="eventType"
          data-value="{{item.id}}"
        >
          {{item.name}}
        </view>
      </view>
    </view>
    
    <view class="filter-section">
      <view class="filter-section-title">é€‰æ‰‹æœç´¢</view>
      <input 
        class="filter-input" 
        placeholder="æŒ‰é€‰æ‰‹å§“åæœç´¢" 
        value="{{filters.player}}"
        bindinput="inputPlayer"
      />
    </view>
    
    <view class="filter-section">
      <view class="filter-section-title">åœ°åŒº</view>
      <input 
        class="filter-input" 
        placeholder="æŒ‰åœ°åŒºæœç´¢" 
        value="{{filters.region}}"
        bindinput="inputRegion"
      />
    </view>
    
    <view class="filter-actions">
      <button class="btn-reset" bindtap="resetFilter">é‡ç½®</button>
      <button class="btn-apply" bindtap="toggleFilter">åº”ç”¨</button>
    </view>
  </view>
  
  <!-- Match List -->
  <view class="match-list">
    <block wx:if="{{matches.length > 0}}">
      <!-- æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤ºæ¯”èµ› -->
      <view wx:for="{{matches}}" wx:for-item="dateGroup" wx:key="date" class="date-group">
        <!-- æ—¥æœŸæ ‡é¢˜ -->
        <view class="date-header">
          <text class="date-display">{{dateGroup.dateDisplay}}</text>
        </view>
        
        <!-- è¯¥æ—¥æœŸä¸‹çš„æ¯”èµ›åˆ—è¡¨ -->
        <view wx:for="{{dateGroup.matches}}" wx:for-item="match" wx:key="_id" class="match-card" bindtap="goToDetail" data-id="{{match._id}}">
          <!-- æ¯”èµ›å¤´éƒ¨ä¿¡æ¯ -->
          <view class="match-header">
            <view class="match-title-section">
              <text class="match-name">{{match.matchName || match.eventType}}</text>
              <text class="match-stage">{{match.stage}}</text>
            </view>
            <view class="match-status">
              <view class="status-badge {{match.status === 'å·²ç»“æŸ' ? 'status-completed' : match.status === 'æ¯”èµ›ä¸­' ? 'status-ongoing' : 'status-registration'}}">
                <view wx:if="{{match.status === 'æ¯”èµ›ä¸­'}}" class="status-dot-animated"></view>
                <text class="status-text">{{match.status === 'å·²ç»“æŸ' ? 'å·²ç»“æŸ' : match.status === 'æ¯”èµ›ä¸­' ? 'è¿›è¡Œä¸­' : 'æŠ¥åä¸­'}}</text>
              </view>
            </view>
          </view>

          <!-- æ¯”èµ›åŸºæœ¬ä¿¡æ¯ -->
          <view class="match-meta">
            <view class="meta-item">
              <text class="meta-icon">ğŸ“</text>
              <text class="meta-text">{{match.venue}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ•</text>
              <text class="meta-text">{{formatMatchTime(match.scheduledTime)}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸŒ</text>
              <text class="meta-text">{{match.region}}</text>
            </view>
          </view>
          
          <!-- é€‰æ‰‹å¯¹æˆ˜ä¿¡æ¯ -->
          <view class="players-section">
            <view class="match-players">
              <!-- é˜Ÿä¼1 -->
              <view class="team-container {{match.score && match.score.winner === 'team1' ? 'winner-team' : ''}}">
                <view class="team-info">
                  <view class="player-list">
                    <view wx:for="{{match.players.team1}}" wx:for-item="player" wx:for-index="playerIndex" wx:key="playerIndex" class="player-item">
                      <text class="player-name">{{player.name}}</text>
                      <text class="player-ranking">æ’å {{player.ranking}}</text>
                    </view>
                  </view>
                  <view wx:if="{{match.score && match.score.winner === 'team1'}}" class="winner-badge">
                    <text class="winner-icon">ğŸ†</text>
                  </view>
                </view>

                <!-- é˜Ÿä¼1æ¯”åˆ† -->
                <view class="score-display" wx:if="{{match.score && match.score.sets.length > 0}}">
                  <view wx:for="{{match.score.sets}}" wx:for-item="set" wx:key="setNumber"
                        class="set-score {{set.team1Score > set.team2Score ? 'set-winner' : ''}}">
                    {{set.team1Score}}
                  </view>
                </view>
              </view>

              <!-- VS åˆ†éš”ç¬¦ -->
              <view class="vs-separator">
                <text class="vs-text">VS</text>
              </view>

              <!-- é˜Ÿä¼2 -->
              <view class="team-container {{match.score && match.score.winner === 'team2' ? 'winner-team' : ''}}">
                <view class="team-info">
                  <view class="player-list">
                    <view wx:for="{{match.players.team2}}" wx:for-item="player" wx:for-index="playerIndex" wx:key="playerIndex" class="player-item">
                      <text class="player-name">{{player.name}}</text>
                      <text class="player-ranking">æ’å {{player.ranking}}</text>
                    </view>
                  </view>
                  <view wx:if="{{match.score && match.score.winner === 'team2'}}" class="winner-badge">
                    <text class="winner-icon">ğŸ†</text>
                  </view>
                </view>

                <!-- é˜Ÿä¼2æ¯”åˆ† -->
                <view class="score-display" wx:if="{{match.score && match.score.sets.length > 0}}">
                  <view wx:for="{{match.score.sets}}" wx:for-item="set" wx:key="setNumber"
                        class="set-score {{set.team2Score > set.team1Score ? 'set-winner' : ''}}">
                    {{set.team2Score}}
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- æ¯”èµ›ç»Ÿè®¡å’Œæ“ä½œ -->
          <view class="match-footer">
            <!-- æ¯”èµ›ç»Ÿè®¡ä¿¡æ¯ -->
            <view class="match-stats" wx:if="{{match.matchStats}}">
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘¥</text>
                <text class="stat-label">è§‚ä¼—</text>
                <text class="stat-value">{{match.matchStats.spectatorCount || 0}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘</text>
                <text class="stat-label">è§‚çœ‹</text>
                <text class="stat-value">{{match.matchStats.viewCount || 0}}</text>
              </view>
              <view class="stat-item" wx:if="{{match.matchStats.duration}}">
                <text class="stat-icon">â±</text>
                <text class="stat-label">æ—¶é•¿</text>
                <text class="stat-value">{{match.matchStats.duration}}</text>
              </view>
            </view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="match-actions">
              <button wx:if="{{match.status === 'æŠ¥åä¸­'}}"
                      class="action-btn primary-btn"
                      catchtap="registerMatch"
                      data-id="{{match._id}}">
                <text class="btn-icon">ğŸ¾</text>
                <text class="btn-text">ç«‹å³æŠ¥å</text>
              </button>
              <view wx:elif="{{match.status === 'æ¯”èµ›ä¸­'}}" class="action-group">
                <button class="action-btn live-btn"
                        catchtap="joinAsSpectator"
                        data-id="{{match._id}}">
                  <text class="btn-icon">ğŸ‘</text>
                  <text class="btn-text">è§‚çœ‹ç›´æ’­</text>
                </button>
                <button class="action-btn secondary-btn"
                        catchtap="goToDetail"
                        data-id="{{match._id}}">
                  <text class="btn-text">è¯¦æƒ…</text>
                </button>
              </view>
              <button wx:else
                      class="action-btn secondary-btn"
                      catchtap="goToDetail"
                      data-id="{{match._id}}">
                <text class="btn-text">æŸ¥çœ‹ç»“æœ</text>
              </button>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- Skeleton Loader -->
    <block wx:if="{{loading && matches.length === 0}}">
      <view class="skeleton-card">
        <view class="skeleton-header"></view>
        <view class="skeleton-content">
          <view class="skeleton-row">
            <view class="skeleton-avatar"></view>
            <view class="skeleton-text-group">
              <view class="skeleton-text short"></view>
              <view class="skeleton-text long"></view>
            </view>
          </view>
          <view class="skeleton-row">
            <view class="skeleton-avatar"></view>
            <view class="skeleton-text-group">
              <view class="skeleton-text short"></view>
              <view class="skeleton-text long"></view>
            </view>
          </view>
          <view class="skeleton-right-section"></view>
        </view>
      </view>
      <view class="skeleton-card">
        <view class="skeleton-header"></view>
        <view class="skeleton-content">
          <view class="skeleton-row">
            <view class="skeleton-avatar"></view>
            <view class="skeleton-text-group">
              <view class="skeleton-text short"></view>
              <view class="skeleton-text long"></view>
            </view>
          </view>
          <view class="skeleton-row">
            <view class="skeleton-avatar"></view>
            <view class="skeleton-text-group">
              <view class="skeleton-text short"></view>
              <view class="skeleton-text long"></view>
            </view>
          </view>
          <view class="skeleton-right-section"></view>
        </view>
      </view>
    </block>

    <!-- Empty State -->
    <view wx:if="{{!loading && matches.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <view class="empty-text">æš‚æ— æ¯”èµ›æ•°æ®ï¼Œå°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–ç¨åå†è¯•ã€‚</view>
    </view>
    
    <!-- Loading State -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
    
    <!-- Load More -->
    <view wx:if="{{hasMore && !loading && matches.length > 0}}" class="load-more" bindtap="loadMoreMatches">
      åŠ è½½æ›´å¤š
    </view>
  </view>
</view> 