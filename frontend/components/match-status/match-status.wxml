<!-- match-status.wxml - æ¯”èµ›çŠ¶æ€ç®¡ç†ç»„ä»¶ -->
<view class="match-status-container">
  <!-- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
  <view class="status-display">
    <view class="status-badge {{getStatusClass(currentStatus)}}">
      <text class="status-icon">{{getStatusIcon(currentStatus)}}</text>
      <text class="status-text">{{getStatusDisplayText(currentStatus)}}</text>
      <view wx:if="{{currentStatus === 'æ¯”èµ›ä¸­'}}" class="live-indicator">
        <text class="live-dot"></text>
        <text class="live-text">LIVE</text>
      </view>
    </view>
    
    <!-- çŠ¶æ€æ—¶é—´ä¿¡æ¯ -->
    <view class="status-time-info" wx:if="{{showTimeInfo}}">
      <text class="time-label">{{getTimeLabel(currentStatus)}}</text>
      <text class="time-value">{{getTimeValue(currentStatus)}}</text>
    </view>
  </view>

  <!-- çŠ¶æ€æ“ä½œæŒ‰é’®ï¼ˆä»…æœ‰æƒé™ç”¨æˆ·å¯è§ï¼‰ -->
  <view class="status-actions" wx:if="{{canManageStatus}}">
    <view class="action-buttons">
      <!-- å¼€å§‹æ¯”èµ› -->
      <button 
        wx:if="{{currentStatus === 'æŠ¥åä¸­' && canStart}}"
        class="action-btn start-btn"
        bindtap="startMatch"
      >
        <text class="btn-icon">â–¶ï¸</text>
        <text class="btn-text">å¼€å§‹æ¯”èµ›</text>
      </button>

      <!-- æš‚åœæ¯”èµ› -->
      <button 
        wx:if="{{currentStatus === 'æ¯”èµ›ä¸­'}}"
        class="action-btn pause-btn"
        bindtap="pauseMatch"
      >
        <text class="btn-icon">â¸ï¸</text>
        <text class="btn-text">æš‚åœæ¯”èµ›</text>
      </button>

      <!-- æ¢å¤æ¯”èµ› -->
      <button 
        wx:if="{{currentStatus === 'å·²æš‚åœ'}}"
        class="action-btn resume-btn"
        bindtap="resumeMatch"
      >
        <text class="btn-icon">â–¶ï¸</text>
        <text class="btn-text">æ¢å¤æ¯”èµ›</text>
      </button>

      <!-- ç»“æŸæ¯”èµ› -->
      <button 
        wx:if="{{currentStatus === 'æ¯”èµ›ä¸­' || currentStatus === 'å·²æš‚åœ'}}"
        class="action-btn end-btn"
        bindtap="endMatch"
      >
        <text class="btn-icon">ğŸ</text>
        <text class="btn-text">ç»“æŸæ¯”èµ›</text>
      </button>

      <!-- å–æ¶ˆæ¯”èµ› -->
      <button 
        wx:if="{{currentStatus !== 'å·²ç»“æŸ' && currentStatus !== 'å·²å–æ¶ˆ'}}"
        class="action-btn cancel-btn"
        bindtap="cancelMatch"
      >
        <text class="btn-icon">âŒ</text>
        <text class="btn-text">å–æ¶ˆæ¯”èµ›</text>
      </button>

      <!-- é‡æ–°å¼€æ”¾æŠ¥å -->
      <button 
        wx:if="{{currentStatus === 'å·²å–æ¶ˆ' && canReopen}}"
        class="action-btn reopen-btn"
        bindtap="reopenRegistration"
      >
        <text class="btn-icon">ğŸ”„</text>
        <text class="btn-text">é‡æ–°å¼€æ”¾</text>
      </button>
    </view>
  </view>

  <!-- çŠ¶æ€å†å²è®°å½• -->
  <view class="status-history" wx:if="{{showHistory && statusHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">çŠ¶æ€å˜æ›´è®°å½•</text>
      <text class="history-toggle" bindtap="toggleHistory">
        {{historyExpanded ? 'æ”¶èµ·' : 'å±•å¼€'}}
      </text>
    </view>
    
    <view class="history-list" wx:if="{{historyExpanded}}">
      <view 
        wx:for="{{statusHistory}}" 
        wx:key="index" 
        class="history-item"
      >
        <view class="history-status-change">
          <text class="from-status">{{getStatusDisplayText(item.fromStatus)}}</text>
          <text class="arrow">â†’</text>
          <text class="to-status">{{getStatusDisplayText(item.toStatus)}}</text>
        </view>
        <view class="history-details">
          <text class="history-time">{{formatTime(item.changedAt)}}</text>
          <text class="history-user" wx:if="{{item.changedBy}}">{{item.changedBy.name}}</text>
        </view>
        <view class="history-reason" wx:if="{{item.reason}}">
          <text class="reason-text">åŸå› : {{item.reason}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€ç¡®è®¤å¯¹è¯æ¡† -->
  <view class="status-modal" wx:if="{{showConfirmModal}}">
    <view class="modal-overlay" bindtap="hideConfirmModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç¡®è®¤{{pendingAction.title}}</text>
      </view>
      
      <view class="modal-body">
        <text class="modal-message">{{pendingAction.message}}</text>
        
        <!-- åŸå› è¾“å…¥ -->
        <view class="reason-input" wx:if="{{pendingAction.needReason}}">
          <text class="input-label">è¯·è¾“å…¥åŸå› ï¼ˆå¯é€‰ï¼‰:</text>
          <textarea 
            class="reason-textarea"
            placeholder="è¯·è¾“å…¥{{pendingAction.title}}çš„åŸå› ..."
            value="{{reasonText}}"
            bindinput="onReasonInput"
            maxlength="200"
          />
          <text class="char-count">{{reasonText.length}}/200</text>
        </view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="hideConfirmModal">
          å–æ¶ˆ
        </button>
        <button
          class="modal-btn confirm-btn {{pendingAction.type}}-confirm"
          bindtap="confirmAction"
        >
          ç¡®è®¤{{pendingAction.title}}
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{updating}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ›´æ–°çŠ¶æ€ä¸­...</text>
  </view>
</view>
