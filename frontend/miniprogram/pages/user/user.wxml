<!-- user.wxml -->
<view class="container">
  <!-- Not Logged In -->
  <view wx:if="{{!isLoggedIn}}" class="not-logged-in">
    <text class="login-banner">ğŸ¾</text>
    <view class="login-text">è¯·ç™»å½•æŸ¥çœ‹æ‚¨çš„ä¸ªäººèµ„æ–™</view>
    <button class="btn-login" bindtap="login">ç™»å½• / æ³¨å†Œ</button>
  </view>
  
  <!-- Logged In -->
  <block wx:else>
    <!-- Loading State -->
    <view wx:if="{{loading}}" class="loading-state">
          <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸ªäººèµ„æ–™ä¸­...</view>
    </view>
    
    <!-- Profile Content -->
    <block wx:elif="{{profile}}">
      <!-- Profile Header -->
      <view class="profile-header">
        <view class="profile-header-content">
          <text class="profile-avatar">ğŸ‘¤</text>
          <view class="profile-info">
            <view class="profile-name">{{profile.nickname || 'ç½‘çƒé€‰æ‰‹'}}</view>
            <view class="profile-id">ID: {{profile.id || 'N/A'}}</view>
          </view>
          <view class="profile-actions">
            <view class="profile-edit" bindtap="editProfile">
              <text class="edit-icon">âœï¸</text>
            </view>
            <view class="profile-logout" bindtap="logout">
              <text class="logout-icon">ğŸšª</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- Stats Summary -->
      <view class="stats-summary">
        <view class="stat-item">
          <view class="stat-value">{{profile.stats.participationCount || 0}}</view>
          <view class="stat-label">æ¯”èµ›</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{profile.stats.wins || 0}}</view>
          <view class="stat-label">èƒœåœº</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{profile.stats.winRate || '0%'}}</view>
          <view class="stat-label">èƒœç‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{profile.stats.etaPoints || 0}}</view>
          <view class="stat-label">ç§¯åˆ†</view>
        </view>
      </view>
      
      <!-- Clubs Section -->
      <view class="section clubs-section">
        <view class="section-header">
          <view class="section-title">æˆ‘çš„ä¿±ä¹éƒ¨</view>
        </view>
        
        <view class="section-content">
          <view wx:if="{{clubsLoading}}" class="loading-mini">åŠ è½½ä¿±ä¹éƒ¨ä¸­...</view>
          <view wx:elif="{{clubs.length === 0}}" class="empty-text">æ‚¨è¿˜æ²¡æœ‰åŠ å…¥ä»»ä½•ä¿±ä¹éƒ¨</view>
          <view wx:else class="clubs-list">
            <view 
              wx:for="{{clubs}}" 
              wx:key="id" 
              class="club-item"
              bindtap="goToClubDetail"
              data-id="{{item.id}}"
            >
              <text class="club-logo">ğŸ¢</text>
              <view class="club-info">
                <view class="club-name">{{item.name}}</view>
                <view class="club-points">{{item.points || 0}} ç§¯åˆ†</view>
              </view>
              <text class="arrow-icon">â¡ï¸</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- Match History Section -->
      <view class="section match-section">
        <view class="section-header">
          <view class="section-title">æ¯”èµ›è®°å½•</view>
        </view>
        
        <!-- Match Filters -->
        <view class="match-filters">
          <view class="filter-group">
            <view 
              class="filter-item {{matchFilters.type === 'all' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="type"
              data-value="all"
            >å…¨éƒ¨ç±»å‹</view>
            <view 
              class="filter-item {{matchFilters.type === 'singles' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="type"
              data-value="singles"
            >å•æ‰“</view>
            <view 
              class="filter-item {{matchFilters.type === 'doubles' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="type"
              data-value="doubles"
            >åŒæ‰“</view>
          </view>
          
          <view class="filter-group">
            <view 
              class="filter-item {{matchFilters.status === 'all' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="status"
              data-value="all"
            >å…¨éƒ¨çŠ¶æ€</view>
            <view 
              class="filter-item {{matchFilters.status === 'completed' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="status"
              data-value="completed"
            >å·²å®Œæˆ</view>
            <view 
              class="filter-item {{matchFilters.status === 'upcoming' ? 'active' : ''}}"
              bindtap="applyMatchFilter"
              data-field="status"
              data-value="upcoming"
            >å³å°†å¼€å§‹</view>
          </view>
        </view>
        
        <!-- Match List -->
        <view class="section-content">
          <view wx:if="{{matchesLoading && matches.length === 0}}" class="loading-mini">åŠ è½½æ¯”èµ›ä¸­...</view>
          <view wx:elif="{{matches.length === 0}}" class="empty-text">æš‚æ— æ¯”èµ›è®°å½•</view>
          <view wx:else class="match-list">
            <view 
              wx:for="{{matches}}" 
              wx:key="id" 
              class="match-item"
              bindtap="goToMatchDetail"
              data-id="{{item._id}}"
            >
              <view class="match-item-header">
                <text>{{item.eventType}}</text>
                <text class="status-label {{item.status ? 'status-' + item.status : ''}}">
                  {{item.stage || 'Match'}}
                </text>
              </view>
              
              <view class="match-item-content">
                <view class="match-players">
                  <view class="match-player">{{item.players[0].name}}</view>
                  <view class="match-vs">VS</view>
                  <view class="match-player">{{item.players[1].name}}</view>
                </view>
                
                <view class="match-info">
                  <view class="match-date">{{item.date || 'N/A'}}</view>
                  <view class="match-venue">{{item.venue || 'N/A'}}</view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- Load More -->
          <view wx:if="{{hasMoreMatches && !matchesLoading && matches.length > 0}}" class="load-more" bindtap="loadMoreMatches">
            åŠ è½½æ›´å¤š
          </view>
          
          <!-- Loading More -->
          <view wx:if="{{matchesLoading && matches.length > 0}}" class="loading-mini">
            åŠ è½½æ›´å¤šä¸­...
          </view>
        </view>
      </view>
    </block>
  </block>
</view> 